{% extends 'home/base.html' %}
{% load bootstrap3 %}

{% block content %}
  <div class="container">

    <div class="row text-center">
      <div class="col-md-12">
        <h1>Primal Scheme Results</h1>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-body">
            <a href="{% url 'home:job_results_csv' }" class="btn btn-success pull-right">
              <i class="fa fa-download"></i> Download as CSV
            </a>

            <dl class="dl-horizontal">
              <dt>Job Name</dt><dd>{{ job.name }}</dd>
              <dt>FASTA file</dt><dd>{{ job.fasta.name }}</dd>
              <dt>Amplicon length</dt><dd>{{ job.amplicon_length }}</dd>
              <dt>Overlap</dt><dd>{{ job.overlap }}</dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">

        <ul class="nav nav-pills">
          <li class="active"><a data-toggle="pill" href="#primer_table">Primer Table</a></li>
          <li><a data-toggle="pill" href="#visualisation">Scheme Visualisation</a></li>
        </ul>

        <div class="tab-content">
          <div id="primer_table" class="tab-pane fade in active">
            <h2>Primer Table</h2>
            <table class="table table-striped">
              <tr>
                <th>Region No.</th>
                <th>Pool</th>
                <th>Left Primer Name</th>
                <th>Left Primer Sequence</th>
                <th>Right Primer Name</th>
                <th>Right Primer Sequence</th>
              </tr>
              {% with job.region_set.all as regions %}
                {% for r in regions %}
                  <tr>
                    <td>{{ r.region_number }}</td>
                    <td>{{ r.pool }}</td>
                    <td>{{ r.top_pair.primer_left.name }}</td>
                    <td>{{ r.top_pair.primer_left.sequence }}</td>
                    <td>{{ r.top_pair.primer_right.name }}</td>
                    <td>{{ r.top_pair.primer_right.sequence }}</td>
                  </tr>
                {% endfor %}
              {% endwith %}
            </table>
          </div>

          <div id="visualisation" class="tab-pane fade">
            <script language="javascript" src="//www.biodalliance.org/release-0.13/dalliance-compiled.js"></script>
            <script language="javascript">
              new Browser({
                chr:          '22',
                viewStart:    30700000,
                viewEnd:      30900000,

                

                sources:     [{name:                 'Genome',
                               twoBitURI:            '//www.biodalliance.org/datasets/hg19.2bit',
                               tier_type:            'sequence'},
                              {name:                 'Genes',
                               desc:                 'Gene structures from GENCODE 19',
                               bwgURI:               '//www.biodalliance.org/datasets/gencode.bb',
                               stylesheet_uri:       '//www.biodalliance.org/stylesheets/gencode.xml',
                               collapseSuperGroups:  true,
                               trixURI:              '//www.biodalliance.org/datasets/geneIndex.ix'},
                              {name:                 'Repeats',
                               desc:                 'Repeat annotation from Ensembl',
                               bwgURI:               '//www.biodalliance.org/datasets/repeats.bb',
                               stylesheet_uri:       '//www.biodalliance.org/stylesheets/bb-repeats.xml'},
                              {name:                 'Conservation',
                               desc:                 'Conservation', 
                               bwgURI:               '//www.biodalliance.org/datasets/phastCons46way.bw',
                               noDownsample:         true}],

              });
            </script>

            <div id="svgHolder"></div>
          </div>
        </div>

      </div>
    </div>
  </div>
{% endblock %}